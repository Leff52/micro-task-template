#  Micro-Task Template

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–∞ Node.js —Å API Gateway, —Å–µ—Ä–≤–∏—Å–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∑–∞–∫–∞–∑–æ–≤.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- API Documentation
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- Endpoints

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ö–ª–∏–µ–Ω—Ç    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   API Gateway       ‚îÇ  :3000
‚îÇ  - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è   ‚îÇ
‚îÇ  - Rate Limiting    ‚îÇ
‚îÇ  - –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ    ‚îÇ
‚îÇ  - Swagger UI       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ      ‚îÇ
       ‚ñº      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ service_ ‚îÇ ‚îÇ service_ ‚îÇ
‚îÇ  users   ‚îÇ ‚îÇ  orders  ‚îÇ
‚îÇ  :4001   ‚îÇ ‚îÇ  :4002   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

- **API Gateway** (–ø–æ—Ä—Ç 3000) - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **service_users** (–ø–æ—Ä—Ç 4001) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **service_orders** (–ø–æ—Ä—Ç 4002) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Runtime:** Node.js 20 (Alpine)
- **Framework:** Express 5
- **Logging:** Pino + Pino-HTTP
- **Validation:** Zod
- **Auth:** JWT 
- **Security:** Helmet, CORS, Rate Limiting
- **Documentation:** Swagger UI, OpenAPI 3.0
- **Testing:** Mocha + Chai 
- **Containerization:** Docker Compose

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Docker** –∏ **Docker Compose** —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ü–æ—Ä—Ç—ã **3000**, **4001**, **4002** —Å–≤–æ–±–æ–¥–Ω—ã

### –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd micro-task-template
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ `.env` —Ñ–∞–π–ª–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# JWT Secret
JWT_SECRET=your_super_secret_key_change_me_in_production

# Service URLs (–¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–≤—è–∑–∏)
USERS_URL=http://service_users:4001
ORDERS_URL=http://service_orders:4002

# Ports
PORT_GATEWAY=3000

# Rate Limiting
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX=100

# Logging
LOG_LEVEL=info
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
docker compose up -d --build
```



### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

- **API Gateway Health:** http://localhost:3000/health
- **Swagger UI:** http://localhost:3000/v1/users/docs/



---

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose up -d

# –ó–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π
docker compose up -d --build

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose down

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker compose logs -f

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker compose logs -f api_gateway
docker compose logs -f service_users
docker compose logs -f service_orders

# –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ volumes
docker compose down -v
```

---
##  –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### E2E —Ç–µ—Å—Ç—ã

–¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–∞ —Ö–æ—Å—Ç–µ –∏ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –∑–∞–ø—É—â–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º.

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Ç–µ—Å—Ç–æ–≤

```bash
npm install
```


#### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

**1. –ß–µ—Ä–µ–∑ API Gateway (–æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π):**

```bash
npm run test:e2e
```

–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π flow —á–µ—Ä–µ–∑ Gateway –Ω–∞ `http://localhost:3000`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
  E2E: Users + Orders
    ‚úî 00) users-—Å–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç (—á–µ—Ä–µ–∑ gateway)
    ‚úî 01) –ª–æ–≥–∏–Ω –∞–¥–º–∏–Ω–∞
    ‚úî 02) —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è user1
    ‚úî 03) –ª–æ–≥–∏–Ω user1 –∏ /me
    ‚úî 04) admin –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    ‚úî 05) admin –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ä–æ–ª–∏ user1
    ‚úî 06) user1 —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑
    ‚úî 07) user1 –≤–∏–¥–∏—Ç —Å–≤–æ–π –∑–∞–∫–∞–∑ –≤ —Å–ø–∏—Å–∫–µ + –ø–∞–≥–∏–Ω–∞—Ü–∏—è
    ‚úî 08) user1 –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π –∑–∞–∫–∞–∑ –ø–æ id
    ‚úî 09) user1 –ù–ï –º–æ–∂–µ—Ç –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å completed
    ‚úî 10) user1 –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å —Å–≤–æ–π –∑–∞–∫–∞–∑
    ‚úî 11) admin –º–æ–∂–µ—Ç –≤—ã—Å—Ç–∞–≤–∏—Ç—å processing
    ‚úî 12) –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∫ —á—É–∂–æ–º—É –∑–∞–∫–∞–∑—É
    ‚úî 13) admin –≤–∏–¥–∏—Ç –≤—Å–µ –∑–∞–∫–∞–∑—ã —Å all=1

  14 passing (732ms)
```

**2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:**

```powershell
#  (–±—É–¥—É—Ç –ø–∞–¥–∞—Ç—å —Ç–µ—Å—Ç—ã —Å Orders)
$env:BASE_URL='http://localhost:4001'; npm run test:e2e

# (–±—É–¥—É—Ç –ø–∞–¥–∞—Ç—å —Ç–µ—Å—Ç—ã —Å Users)
$env:BASE_URL='http://localhost:4002'; npm run test:e2e
```

>  –¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ Gateway —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `/v1/`. –ü—Ä–∏ –ø—Ä—è–º–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–∏—Å–∞–º —Ç–µ—Å—Ç—ã –≤–µ—Ä–Ω—É—Ç 404, —Ç.–∫. —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –ø—É—Ç—è—Ö –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ (`/login`, `/orders`).

---

##  API Documentation

### Swagger UI

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:

**http://localhost:3000/v1/users/docs/**

Swagger UI –¥–æ—Å—Ç—É–ø–µ–Ω **–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API.


#### –õ–æ–≥–∏–Ω

```bash
curl -X POST http://localhost:3000/v1/users/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@example.com",
    "password": "admin123"
  }'
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": "00000000-0000-0000-0000-000000000001",
      "email": "admin@example.com",
      "name": "System Admin",
      "roles": ["admin", "user"]
    }
  }
}
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

```bash
TOKEN="<your-jwt-token>"

curl -X POST http://localhost:3000/v1/orders \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "title": "My Order",
    "description": "Order description"
  }'
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞


---

##  Endpoints

### Users Service (—á–µ—Ä–µ–∑ Gateway)

| –ú–µ—Ç–æ–¥  | Endpoint                      | Auth     | –û–ø–∏—Å–∞–Ω–∏–µ                          |
|--------|-------------------------------|----------|-----------------------------------|
| POST   | `/v1/users/register`          | -        | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è          |
| POST   | `/v1/users/login`             | -        | –í—Ö–æ–¥ (–ø–æ–ª—É—á–µ–Ω–∏–µ JWT)              |
| GET    | `/v1/users/me`                | Bearer   | –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å              |
| GET    | `/v1/users/`                  | Admin    | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π         |
| PATCH  | `/v1/users/:id/roles`         | Admin    | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π                  |
| GET    | `/v1/users/health`            | -        | Health check                      |
| GET    | `/v1/users/docs/`             | -        | Swagger UI                        |

### Orders Service (—á–µ—Ä–µ–∑ Gateway)

| –ú–µ—Ç–æ–¥  | Endpoint                      | Auth     | –û–ø–∏—Å–∞–Ω–∏–µ                          |
|--------|-------------------------------|----------|-----------------------------------|
| POST   | `/v1/orders`                  | Bearer   | –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑                     |
| GET    | `/v1/orders`                  | Bearer   | –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ (—Å–≤–æ–∏ –∏–ª–∏ all=1)   |
| GET    | `/v1/orders/:id`              | Bearer   | –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑ –ø–æ ID              |
| PATCH  | `/v1/orders/:id/status`       | Bearer   | –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å                   |
| GET    | `/v1/orders/health`           | Bearer   | Health check (—Ç—Ä–µ–±—É–µ—Ç Bearer!)    |

### Gateway Endpoints

| –ú–µ—Ç–æ–¥  | Endpoint                      | Auth     | –û–ø–∏—Å–∞–Ω–∏–µ                          |
|--------|-------------------------------|----------|-----------------------------------|
| GET    | `/health`                     | -        | Health check Gateway              |

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### JWT 

- **–ê–ª–≥–æ—Ä–∏—Ç–º:** HS256
- **–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:** 12 —á–∞—Å–æ–≤ (43200 —Å–µ–∫—É–Ω–¥)
- **Secret:** –ó–∞–¥–∞—ë—Ç—Å—è –≤ `.env` —á–µ—Ä–µ–∑ `JWT_SECRET`

### Rate Limiting

- **–û–∫–Ω–æ:** 60 —Å–µ–∫—É–Ω–¥ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `RATE_LIMIT_WINDOW_MS`)
- **–õ–∏–º–∏—Ç:** 100 –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `RATE_LIMIT_MAX`)

### –ó–∞—â–∏—Ç–∞

- **Helmet** - –∑–∞—â–∏—Ç–∞ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- **CORS** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π CORS
- **Bearer Token** - –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è `/v1/orders/*` (–∫—Ä–æ–º–µ health)
- **Path Rewrite** - —Å–∫—Ä—ã—Ç–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

---

## –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:

```json
{
  "email": "admin@example.com",
  "password": "admin123",
  "roles": ["admin", "user"]
}
```

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.


---

##  –õ–∏—Ü–µ–Ω–∑–∏–∏ –Ω–µ—Ç




## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

–Ø –õ–µ–≤ –°—Ç–∞–Ω–∏—Å–ª–∞–≤–æ–≤–∏—á –∏–ª–∏ –∂–µ LeFF52

